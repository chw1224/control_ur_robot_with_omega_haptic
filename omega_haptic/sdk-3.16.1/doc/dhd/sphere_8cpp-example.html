<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Haptic SDK: sphere.cpp</title>
<title>sphere.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo_color_tiny.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief"></div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sphere.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Copyright (C) 2001-2023 Force Dimension, Switzerland.</span></div>
<div class="line"><span class="comment">//  All Rights Reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Force Dimension SDK 3.16.1</span></div>
<div class="line"><span class="comment">//</span><span class="comment"></span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This example illustrates how to combine a haptic rendering loop with a</span></div>
<div class="line"><span class="comment">/// graphic (OpenGL) rendering loop for the same object, in this case a sphere.</span></div>
<div class="line"><span class="comment">/// The sphere object is rendered visually in a GLFW window, while a separate</span></div>
<div class="line"><span class="comment">/// thread haptically renders the interaction between a tool representing the</span></div>
<div class="line"><span class="comment">/// haptic device and the sphere.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">// C++ library headers</span></div>
<div class="line"><span class="preprocessor">#define _USE_MATH_DEFINES</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Platform specific headers</span></div>
<div class="line"><span class="preprocessor">#if defined(WIN32) || defined(WIN64)</span></div>
<div class="line"><span class="preprocessor">#define NOMINMAX</span></div>
<div class="line"><span class="preprocessor">#include &quot;windows.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// GLU library headers</span></div>
<div class="line"><span class="preprocessor">#ifdef MACOSX</span></div>
<div class="line"><span class="preprocessor">#include &quot;OpenGL/glu.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &quot;GL/glu.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Force Dimension SDK library header</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dhdc_8h.html">dhdc.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// GLFW library header</span></div>
<div class="line"><span class="preprocessor">#include &lt;GLFW/glfw3.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Project headers</span></div>
<div class="line"><span class="preprocessor">#include &quot;CMatrixGL.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;FontGL.h&quot;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// Constants</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Position of the sphere in the scene</span></div>
<div class="line"><span class="comment"></span><span class="keyword">const</span> Eigen::Vector3d SpherePosition(0.0, 0.0, 0.0);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Sphere radius in [m]</span></div>
<div class="line"><span class="comment"></span>constexpr <span class="keywordtype">double</span> SphereRadius = 0.03;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Tool size in [m[</span></div>
<div class="line"><span class="comment"></span>constexpr <span class="keywordtype">double</span> ToolRadius = 0.005;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Sphere stiffness in [N/m]</span></div>
<div class="line"><span class="comment"></span>constexpr <span class="keywordtype">double</span> LinearStiffness = 1000.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// GLFW swap interval setting</span></div>
<div class="line"><span class="comment"></span>constexpr <span class="keywordtype">int</span> SwapInterval = 1;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// Global variables</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Simulation running flag</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> simulationRunning = <span class="keyword">true</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Simulation closing synchronization flag</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> simulationFinished = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Number of tools</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">int</span> toolCount = 0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Position of the tools in the scene</span></div>
<div class="line"><span class="comment"></span>Eigen::Vector3d toolPosition[2];</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Rotation available flag</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> useRotation = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Gripper available flag</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> useGripper = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Text overlay flag</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> showRefreshRate = <span class="keyword">true</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// GLFW window handle</span></div>
<div class="line"><span class="comment"></span>GLFWwindow* window = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// GLFW window width in [pixel]</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">int</span> windowWidth = 0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// GLFW window height in [pixel]</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">int</span> windowHeight = 0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function renders the scene using OpenGL.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> updateGraphics()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Clean up.</span></div>
<div class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Retrieve the haptic device orientation frame (identity for 3-dof devices).</span></div>
<div class="line">    <span class="keywordtype">double</span> deviceRotation[3][3] = {};</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a0"></a><a class="code" href="dhdc_8h.html#af1d3c350d6bb73f3989d4c4392db2765">dhdGetOrientationFrame</a>(deviceRotation) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a sphere object.</span></div>
<div class="line">    cMatrixGL matrix;</div>
<div class="line">    matrix.set(SpherePosition);</div>
<div class="line">    matrix.glMatrixPushMultiply();</div>
<div class="line">    GLUquadricObj* sphere = gluNewQuadric();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Render the sphere.</span></div>
<div class="line">    glEnable(GL_COLOR_MATERIAL);</div>
<div class="line">    glColor3f(0.1f, 0.3f, 0.5f);</div>
<div class="line">    gluSphere(sphere, SphereRadius, 32, 32);</div>
<div class="line">    matrix.glMatrixPop();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Render all tools.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; toolCount; index++)</div>
<div class="line">    {</div>
<div class="line">        matrix.set(toolPosition[index], deviceRotation);</div>
<div class="line">        matrix.glMatrixPushMultiply();</div>
<div class="line">        sphere = gluNewQuadric();</div>
<div class="line"> </div>
<div class="line">        glColor3f(0.8f, 0.8f, 0.8f);</div>
<div class="line">        gluSphere(sphere, ToolRadius, 32, 32);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Render a small frame for each tool.</span></div>
<div class="line">        <span class="keywordflow">if</span> (useRotation)</div>
<div class="line">        {</div>
<div class="line">            glDisable(GL_LIGHTING);</div>
<div class="line">            glBegin(GL_LINES);</div>
<div class="line">            glColor3f(0.45f, 0.45f, 0.45f);</div>
<div class="line">            glVertex3d(0.00,  0.000,  0.000);</div>
<div class="line">            glVertex3d(0.02,  0.000,  0.000);</div>
<div class="line">            glVertex3d(0.02, -0.004,  0.000);</div>
<div class="line">            glVertex3d(0.02,  0.004,  0.000);</div>
<div class="line">            glVertex3d(0.02,  0.000, -0.004);</div>
<div class="line">            glVertex3d(0.02,  0.000,  0.004);</div>
<div class="line">            glEnd();</div>
<div class="line">            glEnable(GL_LIGHTING);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        matrix.glMatrixPop();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Render text overlay.</span></div>
<div class="line">    <span class="keywordflow">if</span> (showRefreshRate)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">double</span> lastFrequencyUpdateTime = <a name="a1"></a><a class="code" href="dhdc_8h.html#ad88cff8031c7975479332a9a58aca158">dhdGetTime</a>();</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">char</span> frequencyString[16] = <span class="stringliteral">&quot;0.000 kHz&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Periodically update the haptic refresh rate.</span></div>
<div class="line">        <span class="keywordtype">double</span> time = <a class="code" href="dhdc_8h.html#ad88cff8031c7975479332a9a58aca158">dhdGetTime</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (time - lastFrequencyUpdateTime &gt; 0.1)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">double</span> frequency = <a name="a2"></a><a class="code" href="dhdc_8h.html#a076243abe321a97f4ea022b8bbcb3503">dhdGetComFreq</a>();</div>
<div class="line">            lastFrequencyUpdateTime = time;</div>
<div class="line">            snprintf(frequencyString, 10, <span class="stringliteral">&quot;%0.03f kHz&quot;</span>, frequency);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Render the string.</span></div>
<div class="line">        glDisable(GL_LIGHTING);</div>
<div class="line">        glColor3f(1.0, 1.0, 1.0);</div>
<div class="line">        glRasterPos3f(0.0f, -0.01f, -0.1f);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">char</span>* character = frequencyString; *character != <span class="charliteral">&#39;\0&#39;</span>; character++)</div>
<div class="line">        {</div>
<div class="line">            render_character(*character, HELVETICA12);</div>
<div class="line">        }</div>
<div class="line">        glEnable(GL_LIGHTING);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report any issue.</span></div>
<div class="line">    GLenum err = glGetError();</div>
<div class="line">    <span class="keywordflow">if</span> (err != GL_NO_ERROR)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function implements the haptics loop.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \param a_userData</span></div>
<div class="line"><span class="comment">/// Pointer to user data passed to the haptic thread</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \return</span></div>
<div class="line"><span class="comment">/// A pointer to a return data structure</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span>* hapticsLoop(<span class="keywordtype">void</span>* a_userData)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Allocate and initialize haptic loop variables.</span></div>
<div class="line">    Eigen::Vector3d force;</div>
<div class="line">    force.setZero();</div>
<div class="line">    Eigen::Vector3d forceTool[2];</div>
<div class="line">    forceTool[0].setZero();</div>
<div class="line">    forceTool[1].setZero();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Enable force rendering on the haptic device.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a3"></a><a class="code" href="dhdc_8h.html#a178cf9ffa46dfe3d25dda74ecb34da31">dhdEnableForce</a>(<a name="a4"></a><a class="code" href="dhdc_8h.html#ac60746c35e60ad4c5533dec253a341f1">DHD_ON</a>) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to enable force rendering (&quot;</span> &lt;&lt; <a name="a5"></a><a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the haptic loop.</span></div>
<div class="line">    <span class="keywordflow">while</span> (simulationRunning)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Adapt the behavior to device capabilities.</span></div>
<div class="line">        <span class="keywordtype">double</span> px, py, pz;</div>
<div class="line">        <span class="keywordflow">if</span> (useGripper)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Retrieve the haptic device position.</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a6"></a><a class="code" href="dhdc_8h.html#af3df18474e589b3335776f271921c0fd">dhdGetGripperThumbPos</a>(&amp;px, &amp;py, &amp;pz) &lt; <a name="a7"></a><a class="code" href="dhdc_8h.html#a9a0134b031864add74e6b856f70ee950ab20fde5acabe7cdc218a75b428ccb782">DHD_NO_ERROR</a>)</div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;error: failed to read gripper thumb position (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            toolPosition[0] &lt;&lt; px, py, pz;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Retrieve the haptic device position.</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a8"></a><a class="code" href="dhdc_8h.html#a46954d4c7743f356d2ae2327d0c22f2e">dhdGetGripperFingerPos</a>(&amp;px, &amp;py, &amp;pz) &lt; <a class="code" href="dhdc_8h.html#a9a0134b031864add74e6b856f70ee950ab20fde5acabe7cdc218a75b428ccb782">DHD_NO_ERROR</a>)</div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;error: failed to read gripper finger position (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            toolPosition[1] &lt;&lt; px, py, pz;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Retrieve the haptic device position.</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="dhdc_8h.html#ac6910076186b2709dec3c2bfa38628c2">dhdGetPosition</a>(&amp;px, &amp;py, &amp;pz) &lt; <a class="code" href="dhdc_8h.html#a9a0134b031864add74e6b856f70ee950ab20fde5acabe7cdc218a75b428ccb782">DHD_NO_ERROR</a>)</div>
<div class="line">            {</div>
<div class="line">                std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;error: failed to read position (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            toolPosition[0] &lt;&lt; px, py, pz;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compute the interaction force between the sphere and each tool.</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; toolCount; index++)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Compute the penetration distance.</span></div>
<div class="line">            Eigen::Vector3d direction = (toolPosition[index] - SpherePosition).normalized();</div>
<div class="line">            <span class="keywordtype">double</span> penetrationDistance = (toolPosition[index] - SpherePosition).norm() - SphereRadius - ToolRadius;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the penetration force.</span></div>
<div class="line">            <span class="keywordflow">if</span> (penetrationDistance &lt; 0.0)</div>
<div class="line">            {</div>
<div class="line">                forceTool[index] = -1.0 * penetrationDistance * LinearStiffness * direction;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                forceTool[index].setZero();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compute the force to render on the haptic device.</span></div>
<div class="line">        <span class="keywordtype">double</span> gripperForceMagnitude = 0.0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If the haptic device does not have a gripper, use the current tool force.</span></div>
<div class="line">        <span class="keywordflow">if</span> (!useGripper)</div>
<div class="line">        {</div>
<div class="line">            force = forceTool[0];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If the haptic device has a gripper, compute the projected force on each gripper finger.</span></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Compute the total force.</span></div>
<div class="line">            force = forceTool[0] + forceTool[1];</div>
<div class="line">            Eigen::Vector3d gripperDirection = toolPosition[1] - toolPosition[0];</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// If the total force is not null, project it on both gripper fingers.</span></div>
<div class="line">            <span class="keywordflow">if</span> (gripperDirection.norm() &gt; 0.00001)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Project the mobile gripper finger force (forceGlobal[1]) onto the gripper opening vector (gripperDirection).</span></div>
<div class="line">                gripperDirection.normalize ();</div>
<div class="line">                Eigen::Vector3d gripperForce = (forceTool[1].dot(gripperDirection) / (gripperDirection.squaredNorm())) * gripperDirection;</div>
<div class="line">                gripperForceMagnitude = gripperForce.norm();</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Compute the direction of the force based on the angle between the gripper</span></div>
<div class="line">                <span class="comment">// force vector (gripperForce) and the gripper opening vector (gripperDirection)</span></div>
<div class="line">                <span class="keywordflow">if</span> (force.norm() &gt; 0.001)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">double</span> cosAngle = gripperDirection.dot(gripperForce) / (gripperDirection.norm() * gripperForce.norm());</div>
<div class="line">                    cosAngle = std::min(1.0, cosAngle);</div>
<div class="line">                    cosAngle = std::max(-1.0, cosAngle);</div>
<div class="line">                    <span class="keywordtype">double</span> angle = acos(cosAngle);</div>
<div class="line">                    <span class="keywordflow">if</span> ((angle &gt; M_PI / 2.0) || (angle &lt; -M_PI / 2.0))</div>
<div class="line">                    {</div>
<div class="line">                        gripperForceMagnitude = -gripperForceMagnitude;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Invert the gripper force direction for left-handed devices.</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="dhdc_8h.html#ac34fa37c8a4c813adf10c11ca941dcbe">dhdIsLeftHanded</a>())</div>
<div class="line">            {</div>
<div class="line">                gripperForceMagnitude = -gripperForceMagnitude;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Only enable haptic rendering once the device is in free space.</span></div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">bool</span> safeToRenderHaptics = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (!safeToRenderHaptics)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (force.norm() == 0.0 &amp;&amp; gripperForceMagnitude == 0.0)</div>
<div class="line">            {</div>
<div class="line">                safeToRenderHaptics = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                force.setZero();</div>
<div class="line">                gripperForceMagnitude = 0.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Apply all forces at once.</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a11"></a><a class="code" href="dhdc_8h.html#aa2beb27a94c693149603619d44fc2725">dhdSetForceAndGripperForce</a>(force(0), force(1), force(2), gripperForceMagnitude) &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to render force (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Flag the simulation as having finished.</span></div>
<div class="line">    simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">    simulationFinished = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when the application exits.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onExit()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Wait for the haptic loop to finish.</span></div>
<div class="line">    simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">while</span> (!simulationFinished)</div>
<div class="line">    {</div>
<div class="line">        <a name="a12"></a><a class="code" href="dhdc_8h.html#a6bf00afebdd74ec809698a0ee94d3a3b">dhdSleep</a>(0.1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close the connection to the haptic device.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a13"></a><a class="code" href="dhdc_8h.html#a42388a26aa14cb291eedcebb7029d688">dhdClose</a>() &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to close the connection (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;connection closed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when the GLFW window is resized.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onWindowResized(GLFWwindow* a_window,</div>
<div class="line">                     <span class="keywordtype">int</span> a_width,</div>
<div class="line">                     <span class="keywordtype">int</span> a_height)</div>
<div class="line">{</div>
<div class="line">    windowWidth = a_width;</div>
<div class="line">    windowHeight = a_height;</div>
<div class="line">    <span class="keywordtype">double</span> glAspect = (<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(a_width) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(a_height));</div>
<div class="line"> </div>
<div class="line">    glViewport(0, 0, a_width, a_height);</div>
<div class="line">    glMatrixMode(GL_PROJECTION);</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">    gluPerspective(60, glAspect, 0.01, 10);</div>
<div class="line">    gluLookAt(0.2, 0.0, 0.0,</div>
<div class="line">              0.0, 0.0, 0.0,</div>
<div class="line">              0.0, 0.0, 1.0);</div>
<div class="line">    glMatrixMode(GL_MODELVIEW);</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when a key is pressed in the GLFW window.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onKeyPressed(GLFWwindow* a_window,</div>
<div class="line">                  <span class="keywordtype">int</span> a_key,</div>
<div class="line">                  <span class="keywordtype">int</span> a_scanCode,</div>
<div class="line">                  <span class="keywordtype">int</span> a_action,</div>
<div class="line">                  <span class="keywordtype">int</span> a_modifiers)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Ignore all keyboard events that are not key presses.</span></div>
<div class="line">    <span class="keywordflow">if</span> (a_action != GLFW_PRESS)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Detect exit requests.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((a_key == GLFW_KEY_ESCAPE) || (a_key == GLFW_KEY_Q))</div>
<div class="line">    {</div>
<div class="line">        exit(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Toggle the display of the refresh rate.</span></div>
<div class="line">    <span class="keywordflow">if</span> (a_key == GLFW_KEY_R)</div>
<div class="line">    {</div>
<div class="line">        showRefreshRate = !showRefreshRate;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when the GLFW library reports an error.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onError(<span class="keywordtype">int</span> a_error,</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">char</span>* a_description)</div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; a_description &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function initializes the GLFW window.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \return</span></div>
<div class="line"><span class="comment">/// 0 on success, -1 on failure.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> initializeGLFW()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialize the GLFW library.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!glfwInit())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the error callback.</span></div>
<div class="line">    glfwSetErrorCallback(onError);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute the desired window size.</span></div>
<div class="line">    <span class="keyword">const</span> GLFWvidmode* mode = glfwGetVideoMode(glfwGetPrimaryMonitor());</div>
<div class="line">    windowWidth = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.8 *  mode-&gt;height);</div>
<div class="line">    windowHeight = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * mode-&gt;height);</div>
<div class="line">    <span class="keywordtype">int</span> x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * (mode-&gt;width - windowWidth));</div>
<div class="line">    <span class="keywordtype">int</span> y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * (mode-&gt;height - windowHeight));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure OpenGL rendering.</span></div>
<div class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 2);</div>
<div class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 1);</div>
<div class="line">    glfwWindowHint(GLFW_DOUBLEBUFFER, GLFW_TRUE);</div>
<div class="line">    glfwWindowHint(GLFW_SAMPLES, 4);</div>
<div class="line">    glfwWindowHint(GLFW_STEREO, GL_FALSE);</div>
<div class="line">    glfwWindowHint(GLFW_VISIBLE, GL_FALSE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Apply platform-specific settings.</span></div>
<div class="line"><span class="preprocessor">#ifdef MACOSX</span></div>
<div class="line"> </div>
<div class="line">    glfwWindowHint(GLFW_COCOA_RETINA_FRAMEBUFFER, GL_FALSE);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create the GLFW window and OpenGL display context.</span></div>
<div class="line">    window = glfwCreateWindow(windowWidth, windowHeight, <span class="stringliteral">&quot;Force Dimension - OpenGL Sphere Example&quot;</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!window)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    glfwMakeContextCurrent(window);</div>
<div class="line">    glfwSetKeyCallback(window, onKeyPressed);</div>
<div class="line">    glfwSetWindowSizeCallback(window, onWindowResized);</div>
<div class="line">    glfwSetWindowPos(window, x, y);</div>
<div class="line">    glfwSwapInterval(SwapInterval);</div>
<div class="line">    glfwShowWindow(window);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Adjust initial window size</span></div>
<div class="line">    onWindowResized(window, windowWidth, windowHeight);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Define material properties.</span></div>
<div class="line">    GLfloat mat_ambient[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    GLfloat mat_diffuse[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    GLfloat mat_specular[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT, mat_ambient);</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_DIFFUSE, mat_diffuse);</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, mat_specular);</div>
<div class="line">    glMaterialf(GL_FRONT_AND_BACK, GL_SHININESS, 1.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Define light sources.</span></div>
<div class="line">    GLfloat ambient[] = { 0.5f, 0.5f, 0.5f, 1.0f };</div>
<div class="line">    GLfloat diffuse[] = { 0.8f, 0.8f, 0.8f, 1.0f };</div>
<div class="line">    GLfloat specular[] = { 1.0f, 1.0f, 1.0f, 1.0f };</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_SPECULAR, specular);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_CONSTANT_ATTENUATION, 1.0);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_LINEAR_ATTENUATION, 0.0);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_QUADRATIC_ATTENUATION, 0.0);</div>
<div class="line"> </div>
<div class="line">    GLfloat lightPos[] = { 2.0, 0.0, 0.0, 1.0f };</div>
<div class="line">    GLfloat lightDir[] = { -1.0, 0.0, 0.0, 1.0f };</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_POSITION, lightPos);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, lightDir);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_SPOT_CUTOFF, 180);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_SPOT_EXPONENT, 1.0);</div>
<div class="line">    glEnable(GL_LIGHTING);</div>
<div class="line">    glEnable(GL_LIGHT0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Use depth buffering for hidden surface elimination.</span></div>
<div class="line">    glEnable(GL_DEPTH_TEST);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear the OpenGL color buffer.</span></div>
<div class="line">    glClearColor(0.0, 0.0, 0.0, 1.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function initializes the haptic device.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \return</span></div>
<div class="line"><span class="comment">/// 0 on success, -1 on failure.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> initializeHaptics()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Open the first available haptic device.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a14"></a><a class="code" href="dhdc_8h.html#ac47b700c1bdb9d46b1005f1cfabb7607">dhdOpen</a>() &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Store the haptic device properties.</span></div>
<div class="line">    useRotation = <a name="a15"></a><a class="code" href="dhdc_8h.html#a2ab4505d6dab45cf411e7c45560f1447">dhdHasWrist</a>();</div>
<div class="line">    useGripper = <a name="a16"></a><a class="code" href="dhdc_8h.html#a15e1d081d33220cd75c6a37506e0ba79">dhdHasGripper</a>();</div>
<div class="line">    toolCount = (useGripper) ? 2 : 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function initializes the simulation.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \return</span></div>
<div class="line"><span class="comment">/// 0 on success, -1 on failure.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> initializeSimulation()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialize all tool positions.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; toolCount; index++)</div>
<div class="line">    {</div>
<div class="line">        toolPosition[index].setZero();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,</div>
<div class="line">         <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Display version information.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;OpenGL Sphere Example &quot;</span> &lt;&lt; <a name="a17"></a><a class="code" href="dhdc_8h.html#a922e46d7c95f29648069c8f47d4c4a99">dhdGetSDKVersionStr</a>() &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Copyright (C) 2001-2023 Force Dimension&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;All Rights Reserved.&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Find and open a connection to a haptic device.</span></div>
<div class="line">    <span class="keywordflow">if</span> (initializeHaptics() &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to initialize haptics&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open a GLFW window to render the simulation.</span></div>
<div class="line">    <span class="keywordflow">if</span> (initializeGLFW() &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to initialize GLFW&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize simulation objects.</span></div>
<div class="line">    <span class="keywordflow">if</span> (initializeSimulation() &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to initialize the simulation&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a high priority haptic thread.</span></div>
<div class="line"><span class="preprocessor">#if defined(WIN32) || defined(WIN64)</span></div>
<div class="line"> </div>
<div class="line">    DWORD threadHandle;</div>
<div class="line">    CreateThread(<span class="keyword">nullptr</span>, 0, (LPTHREAD_START_ROUTINE)(hapticsLoop), <span class="keyword">nullptr</span>, 0x0000, &amp;threadHandle);</div>
<div class="line">    SetThreadPriority(&amp;threadHandle, THREAD_PRIORITY_ABOVE_NORMAL);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"> </div>
<div class="line">    pthread_t threadHandle;</div>
<div class="line">    pthread_create(&amp;threadHandle, <span class="keyword">nullptr</span>, hapticsLoop, <span class="keyword">nullptr</span>);</div>
<div class="line">    <span class="keyword">struct </span>sched_param schedulerParameters;</div>
<div class="line">    memset(&amp;schedulerParameters, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sched_param));</div>
<div class="line">    schedulerParameters.sched_priority = 10;</div>
<div class="line">    pthread_setschedparam(threadHandle, SCHED_RR, &amp;schedulerParameters);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Register a callback that stops the haptic thread when the application exits.</span></div>
<div class="line">    atexit(onExit);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display the device type.</span></div>
<div class="line">    std::cout &lt;&lt; <a name="a18"></a><a class="code" href="dhdc_8h.html#aa5ff16e7ee635f5a2ac186ead8d075c9">dhdGetSystemName</a>() &lt;&lt; <span class="stringliteral">&quot; device detected&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display user instructions.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;press &#39;r&#39; to toggle display of the haptic rate&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;      &#39;q&#39; to quit&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Main graphic loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (simulationRunning &amp;&amp; !glfwWindowShouldClose(window))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Render graphics.</span></div>
<div class="line">        <span class="keywordflow">if</span> (updateGraphics() &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to update graphics&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Swap buffers.</span></div>
<div class="line">        glfwSwapBuffers(window);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Process GLFW events.</span></div>
<div class="line">        glfwPollEvents();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close the GLFW window.</span></div>
<div class="line">    glfwDestroyWindow(window);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close the GLFW library.</span></div>
<div class="line">    glfwTerminate();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="adhdc_8h_html_ac6910076186b2709dec3c2bfa38628c2"><div class="ttname"><a href="dhdc_8h.html#ac6910076186b2709dec3c2bfa38628c2">dhdGetPosition</a></div><div class="ttdeci">int __SDK dhdGetPosition(double *px, double *py, double *pz, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:1606</div></div>
<div class="ttc" id="adhdc_8h_html_ac60746c35e60ad4c5533dec253a341f1"><div class="ttname"><a href="dhdc_8h.html#ac60746c35e60ad4c5533dec253a341f1">DHD_ON</a></div><div class="ttdeci">#define DHD_ON</div><div class="ttdef"><b>Definition:</b> dhdc.h:126</div></div>
<div class="ttc" id="adhdc_8h_html_ac34fa37c8a4c813adf10c11ca941dcbe"><div class="ttname"><a href="dhdc_8h.html#ac34fa37c8a4c813adf10c11ca941dcbe">dhdIsLeftHanded</a></div><div class="ttdeci">bool __SDK dhdIsLeftHanded(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:574</div></div>
<div class="ttc" id="adhdc_8h_html_a9a0134b031864add74e6b856f70ee950ab20fde5acabe7cdc218a75b428ccb782"><div class="ttname"><a href="dhdc_8h.html#a9a0134b031864add74e6b856f70ee950ab20fde5acabe7cdc218a75b428ccb782">DHD_NO_ERROR</a></div><div class="ttdeci">@ DHD_NO_ERROR</div><div class="ttdef"><b>Definition:</b> dhdc.h:54</div></div>
<div class="ttc" id="adhdc_8h_html_a46954d4c7743f356d2ae2327d0c22f2e"><div class="ttname"><a href="dhdc_8h.html#a46954d4c7743f356d2ae2327d0c22f2e">dhdGetGripperFingerPos</a></div><div class="ttdeci">int __SDK dhdGetGripperFingerPos(double *px, double *py, double *pz, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4603</div></div>
<div class="ttc" id="adhdc_8h_html_aa493832a39c7e31b44752bda5d601209"><div class="ttname"><a href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a></div><div class="ttdeci">const char *__SDK dhdErrorGetLastStr()</div><div class="ttdef"><b>Definition:</b> dhdError.cpp:197</div></div>
<div class="ttc" id="adhdc_8h_html_a076243abe321a97f4ea022b8bbcb3503"><div class="ttname"><a href="dhdc_8h.html#a076243abe321a97f4ea022b8bbcb3503">dhdGetComFreq</a></div><div class="ttdeci">double __SDK dhdGetComFreq(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4636</div></div>
<div class="ttc" id="adhdc_8h_html"><div class="ttname"><a href="dhdc_8h.html">dhdc.h</a></div><div class="ttdoc">DHD header file.</div></div>
<div class="ttc" id="adhdc_8h_html_a15e1d081d33220cd75c6a37506e0ba79"><div class="ttname"><a href="dhdc_8h.html#a15e1d081d33220cd75c6a37506e0ba79">dhdHasGripper</a></div><div class="ttdeci">bool __SDK dhdHasGripper(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:691</div></div>
<div class="ttc" id="adhdc_8h_html_a178cf9ffa46dfe3d25dda74ecb34da31"><div class="ttname"><a href="dhdc_8h.html#a178cf9ffa46dfe3d25dda74ecb34da31">dhdEnableForce</a></div><div class="ttdeci">int __SDK dhdEnableForce(uchar val, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4360</div></div>
<div class="ttc" id="adhdc_8h_html_aa5ff16e7ee635f5a2ac186ead8d075c9"><div class="ttname"><a href="dhdc_8h.html#aa5ff16e7ee635f5a2ac186ead8d075c9">dhdGetSystemName</a></div><div class="ttdeci">const char *__SDK dhdGetSystemName(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:806</div></div>
<div class="ttc" id="adhdc_8h_html_af3df18474e589b3335776f271921c0fd"><div class="ttname"><a href="dhdc_8h.html#af3df18474e589b3335776f271921c0fd">dhdGetGripperThumbPos</a></div><div class="ttdeci">int __SDK dhdGetGripperThumbPos(double *px, double *py, double *pz, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4564</div></div>
<div class="ttc" id="adhdc_8h_html_a42388a26aa14cb291eedcebb7029d688"><div class="ttname"><a href="dhdc_8h.html#a42388a26aa14cb291eedcebb7029d688">dhdClose</a></div><div class="ttdeci">int __SDK dhdClose(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:443</div></div>
<div class="ttc" id="adhdc_8h_html_ac47b700c1bdb9d46b1005f1cfabb7607"><div class="ttname"><a href="dhdc_8h.html#ac47b700c1bdb9d46b1005f1cfabb7607">dhdOpen</a></div><div class="ttdeci">int __SDK dhdOpen()</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:265</div></div>
<div class="ttc" id="adhdc_8h_html_a6bf00afebdd74ec809698a0ee94d3a3b"><div class="ttname"><a href="dhdc_8h.html#a6bf00afebdd74ec809698a0ee94d3a3b">dhdSleep</a></div><div class="ttdeci">void __SDK dhdSleep(double sec)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4736</div></div>
<div class="ttc" id="adhdc_8h_html_a2ab4505d6dab45cf411e7c45560f1447"><div class="ttname"><a href="dhdc_8h.html#a2ab4505d6dab45cf411e7c45560f1447">dhdHasWrist</a></div><div class="ttdeci">bool __SDK dhdHasWrist(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:635</div></div>
<div class="ttc" id="adhdc_8h_html_a922e46d7c95f29648069c8f47d4c4a99"><div class="ttname"><a href="dhdc_8h.html#a922e46d7c95f29648069c8f47d4c4a99">dhdGetSDKVersionStr</a></div><div class="ttdeci">const char *__SDK dhdGetSDKVersionStr()</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:917</div></div>
<div class="ttc" id="adhdc_8h_html_aa2beb27a94c693149603619d44fc2725"><div class="ttname"><a href="dhdc_8h.html#aa2beb27a94c693149603619d44fc2725">dhdSetForceAndGripperForce</a></div><div class="ttdeci">int __SDK dhdSetForceAndGripperForce(double fx, double fy, double fz, double fg, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4660</div></div>
<div class="ttc" id="adhdc_8h_html_ad88cff8031c7975479332a9a58aca158"><div class="ttname"><a href="dhdc_8h.html#ad88cff8031c7975479332a9a58aca158">dhdGetTime</a></div><div class="ttdeci">double __SDK dhdGetTime()</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:190</div></div>
<div class="ttc" id="adhdc_8h_html_af1d3c350d6bb73f3989d4c4392db2765"><div class="ttname"><a href="dhdc_8h.html#af1d3c350d6bb73f3989d4c4392db2765">dhdGetOrientationFrame</a></div><div class="ttdeci">int __SDK dhdGetOrientationFrame(double matrix[3][3], char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4534</div></div>
<address class="separator"><hr>
</address>
<address class="footer">
<font size=-2>
<b>Haptic SDK 3.16.1 documentation</b><br>
Please address any questions to <a href="mailto:support@forcedimension.com">support@forcedimension.com</a><br>(C) 2001-2023 - <a href="http://www.forcedimension.com">Force Dimension</a><br>
All Rights Reserved.
</font>
</address>
</body>
</html>
