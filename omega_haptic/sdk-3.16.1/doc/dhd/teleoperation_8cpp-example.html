<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Haptic SDK: teleoperation.cpp</title>
<title>teleoperation.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo_color_tiny.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief"></div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">teleoperation.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Copyright (C) 2001-2023 Force Dimension, Switzerland.</span></div>
<div class="line"><span class="comment">//  All Rights Reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Force Dimension SDK 3.16.1</span></div>
<div class="line"><span class="comment">//</span><span class="comment"></span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This example implements a simple teleoperation control loop.</span></div>
<div class="line"><span class="comment">/// The robot movement is relative to the haptic device location when the user</span></div>
<div class="line"><span class="comment">/// button on the haptic device is held pressed. Alternatively, the space bar</span></div>
<div class="line"><span class="comment">/// can be used to toggle the teleoperation state between engaged and</span></div>
<div class="line"><span class="comment">/// disengaged.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// The teleoperation logic is encapsulated in the \ref</span></div>
<div class="line"><span class="comment">/// teleoperationControlLoop() function. Motion scaling, haptic stiffness and</span></div>
<div class="line"><span class="comment">/// damping can be modified at build time by changing the values in the \ref</span></div>
<div class="line"><span class="comment">/// teleoperationControlLoop() function. The rest of the code handles mostly</span></div>
<div class="line"><span class="comment">/// the graphic display and the limited keyboard interaction.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// The haptic feedback conveys the limits of the dummy robot workspace defined</span></div>
<div class="line"><span class="comment">/// in the Robot.h header. The dummy robot \ref Robot::setTarget()</span></div>
<div class="line"><span class="comment">/// implementation contains simple workspace limits to provide linear and</span></div>
<div class="line"><span class="comment">/// angular limits that the teleoperation loop uses to compute haptic feedback.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">// C++ library headers</span></div>
<div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Platform-specific headers</span></div>
<div class="line"><span class="preprocessor">#if defined(WIN32) | defined(WIN64)</span></div>
<div class="line"><span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// FD SDK library headers</span></div>
<div class="line"><span class="preprocessor">#include &quot;drdc.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// GLFW library headers</span></div>
<div class="line"><span class="preprocessor">#include &lt;GLFW/glfw3.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// GLU headers</span></div>
<div class="line"><span class="preprocessor">#ifdef MACOSX</span></div>
<div class="line"><span class="preprocessor">#include &quot;OpenGL/glu.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &quot;GL/glu.h&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Project headers</span></div>
<div class="line"><span class="preprocessor">#include &quot;Robot.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Transform.h&quot;</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global simulation running flag</span></div>
<div class="line"><span class="comment"></span>std::atomic&lt;bool&gt; simulationRunning = <span class="keyword">true</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global teleoperation engagement override</span></div>
<div class="line"><span class="comment"></span>std::atomic&lt;bool&gt; engageOverride = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global master haptic input device transform</span></div>
<div class="line"><span class="comment"></span>Transform masterCurrent;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global slave robot target transform</span></div>
<div class="line"><span class="comment"></span>Transform slaveTarget;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global slave robot current transform</span></div>
<div class="line"><span class="comment"></span>Transform slaveCurrent;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Global dummy robot object</span></div>
<div class="line"><span class="comment"></span>Robot slaveRobot;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function renders the scene using OpenGL.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> updateGraphics()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Rendering settings</span></div>
<div class="line">    constexpr <span class="keywordtype">float</span> HapticSphereRadius = 0.01f;</div>
<div class="line">    constexpr <span class="keywordtype">float</span> TargetSphereRadius = 0.005f;</div>
<div class="line">    constexpr <span class="keywordtype">float</span> RobotSphereRadius = 0.01f;</div>
<div class="line">    constexpr <span class="keywordtype">float</span> HapticFrameSize = 0.04f;</div>
<div class="line">    constexpr <span class="keywordtype">float</span> TargetFrameSize = 0.02f;</div>
<div class="line">    constexpr <span class="keywordtype">float</span> RobotFrameSize = 0.04f;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize rendering settings.</span></div>
<div class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>
<div class="line">    glEnable(GL_DEPTH_TEST);</div>
<div class="line">    glClearColor(0.0, 0.0, 0.0, 1.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare sphere with frame rendering lambda.</span></div>
<div class="line">    <span class="keyword">auto</span> renderSphere = [](<span class="keywordtype">double</span>* a_transform,</div>
<div class="line">                           <span class="keywordtype">float</span> a_red, <span class="keywordtype">float</span> a_green, <span class="keywordtype">float</span> a_blue,</div>
<div class="line">                           <span class="keywordtype">float</span> a_radius,</div>
<div class="line">                           <span class="keywordtype">float</span> a_frameSize)</div>
<div class="line">    {</div>
<div class="line">        glPushMatrix();</div>
<div class="line">        glMultMatrixd(a_transform);</div>
<div class="line">        glEnable(GL_COLOR_MATERIAL);</div>
<div class="line">        glColor3f(a_red, a_green, a_blue);</div>
<div class="line">        GLUquadricObj* sphere = gluNewQuadric();</div>
<div class="line">        gluSphere(sphere, a_radius, 32, 32);</div>
<div class="line">        gluDeleteQuadric(sphere);</div>
<div class="line">        glDisable(GL_LIGHTING);</div>
<div class="line">        glBegin(GL_LINES);</div>
<div class="line">        glColor3f(1.0f, 0.0f, 0.0f);</div>
<div class="line">        glVertex3d(0.00, 0.00, 0.00);</div>
<div class="line">        glVertex3d(a_frameSize, 0.00, 0.00);</div>
<div class="line">        glColor3f(0.0f, 1.0f, 0.0f);</div>
<div class="line">        glVertex3d(0.00, 0.00, 0.00);</div>
<div class="line">        glVertex3d(0.00, a_frameSize, 0.00);</div>
<div class="line">        glColor3f(0.0f, 0.0f, 1.0f);</div>
<div class="line">        glVertex3d(0.00, 0.00, 0.00);</div>
<div class="line">        glVertex3d(0.00, 0.00, a_frameSize);</div>
<div class="line">        glEnd();</div>
<div class="line">        glEnable(GL_LIGHTING);</div>
<div class="line">        glPopMatrix();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display a sphere and frame for the master haptic device.</span></div>
<div class="line">    renderSphere(masterCurrent.matrix().data(), 0.5f, 0.5f, 0.5f, HapticSphereRadius, HapticFrameSize);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display a smaller sphere and frame for the slave robot target.</span></div>
<div class="line">    renderSphere(slaveTarget.matrix().data(), 0.2f, 0.2f, 0.2f, TargetSphereRadius, TargetFrameSize);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display a sphere and frame for the slave robot.</span></div>
<div class="line">    renderSphere(slaveCurrent.matrix().data(), 0.5f, 0.5f, 0.5f, RobotSphereRadius, RobotFrameSize);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for all rendering operations to complete.</span></div>
<div class="line">    glFinish();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report any issue.</span></div>
<div class="line">    GLenum err = glGetError();</div>
<div class="line">    <span class="keywordflow">if</span> (err != GL_NO_ERROR)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> teleoperationControlLoop(<span class="keywordtype">int</span> a_deviceId)</div>
<div class="line">{<span class="comment"></span></div>
<div class="line"><span class="comment">    /// Scaling factor between master translation and slave translation.</span></div>
<div class="line"><span class="comment">    /// A value greater than 1.0 means that the slave&#39;s movement will be</span></div>
<div class="line"><span class="comment">    /// larger than the master&#39;s.</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> LinearScaling = 0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Scaling factor between master rotation and slave rotation.</span></div>
<div class="line"><span class="comment">    /// A value greater than 1.0 means that the slave&#39;s movement will be</span></div>
<div class="line"><span class="comment">    /// larger than the master&#39;s.</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> AngularScaling = 0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Master linear damping when teleoperation is engaged in [N/(m/s)]</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> LinearDamping = 10.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Master angular damping when teleoperation is engaged in [Nm/(rad/s)]</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> AngularDamping = 0.01;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Linear stiffness of the virtual spring between desired and actual slave positions in [N/m].</span></div>
<div class="line"><span class="comment">    /// We normalize it by the linear scaling so that the apparent stiffness (from the haptic device&#39;s</span></div>
<div class="line"><span class="comment">    /// user perspective) remains the same, regardless of the movement scaling.</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> LinearStiffness = 4000.0 / LinearScaling;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Angular stiffness of the virtual spring between desired and actual slave positions in [Nm/rad].</span></div>
<div class="line"><span class="comment">    /// We normalize it by the angular scaling so that the apparent stiffness (from the haptic device&#39;s</span></div>
<div class="line"><span class="comment">    /// user perspective) remains the same, regardless of the movement scaling.</span></div>
<div class="line"><span class="comment"></span>    constexpr <span class="keywordtype">double</span> AngularStiffness = 4.0 / AngularScaling;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;teleoperation thread running&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare state variables used to retrieve data from the master haptic device.</span></div>
<div class="line">    <span class="keywordtype">double</span> masterX = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterY = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterZ = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterRotation[3][3] = {};</div>
<div class="line">    <span class="keywordtype">double</span> masterLinearVelocityX = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterLinearVelocityY = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterLinearVelocityZ = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterAngularVelocityX = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterAngularVelocityY = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> masterAngularVelocityZ = 0.0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Declare all teleoperation control variables.</span></div>
<div class="line">    <span class="keywordtype">bool</span> teleoperationEngaged = <span class="keyword">false</span>;</div>
<div class="line">    Eigen::Vector3d masterStartPosition;</div>
<div class="line">    Eigen::Matrix3d masterStartRotation;</div>
<div class="line">    Eigen::Vector3d slaveStartPosition;</div>
<div class="line">    Eigen::Matrix3d slaveStartRotation;</div>
<div class="line">    Eigen::Vector3d force;</div>
<div class="line">    Eigen::Vector3d torque;</div>
<div class="line">    Eigen::AngleAxisd previousMasterAngularMove;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stop robotic regulation of the master haptic device, but leave it with forces enabled.</span></div>
<div class="line">    <span class="keywordflow">if</span> (drdStop(<span class="keyword">true</span>, a_deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to stop robotic regulation (&quot;</span> &lt;&lt; <a name="a0"></a><a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Enable button emulation on devices featuring a gripper.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a1"></a><a class="code" href="dhdc_8h.html#a89cfe26f64150f8829daa35d9a302dc8">dhdHasActiveGripper</a>(a_deviceId) &amp;&amp; <a name="a2"></a><a class="code" href="dhdc_8h.html#aa23bc77b009e020c05ef725eb533b60c">dhdEmulateButton</a>(<a name="a3"></a><a class="code" href="dhdc_8h.html#ac60746c35e60ad4c5533dec253a341f1">DHD_ON</a>, a_deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to enable button emulation (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Teleoperation control loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (simulationRunning)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Retrieve the haptic device position and velocity.</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a4"></a><a class="code" href="dhdc_8h.html#a4e6e5502f908607bfdf1e017d7fa76ec">dhdGetPositionAndOrientationFrame</a>(&amp;masterX, &amp;masterY, &amp;masterZ, masterRotation, a_deviceId) &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to get haptic position (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a5"></a><a class="code" href="dhdc_8h.html#a2a29fb157bbcd49cd1807a5febf314e7">dhdGetLinearVelocity</a>(&amp;masterLinearVelocityX, &amp;masterLinearVelocityY, &amp;masterLinearVelocityZ, a_deviceId) &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to retrieve master linear velocity (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a6"></a><a class="code" href="dhdc_8h.html#ac712aa9c49acad0e9e30c28b732fc5ca">dhdGetAngularVelocityRad</a>(&amp;masterAngularVelocityX, &amp;masterAngularVelocityY, &amp;masterAngularVelocityZ, a_deviceId) &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to retrieve master angular velocity (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Put master haptic device state into useful control variables.</span></div>
<div class="line">        masterCurrent.set(masterX, masterY, masterZ, masterRotation);</div>
<div class="line">        Eigen::Vector3d masterLinearVelocity { masterLinearVelocityX, masterLinearVelocityY, masterLinearVelocityZ };</div>
<div class="line">        Eigen::Vector3d masterAngularVelocity { masterAngularVelocityX, masterAngularVelocityY, masterAngularVelocityZ };</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update the slave robot current position.</span></div>
<div class="line">        slaveCurrent = slaveRobot.current();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Read the status of the user button.</span></div>
<div class="line">        <span class="keywordtype">bool</span> buttonEngaged = (<a name="a7"></a><a class="code" href="dhdc_8h.html#a954c547357c73924b75bdf576f2abe12">dhdGetButton</a>(0) != <a name="a8"></a><a class="code" href="dhdc_8h.html#aafe2b84f08a09e2acceb53b5ac6fd5f1">DHD_OFF</a>) || engageOverride;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Handle teloperation engage/disengage events.</span></div>
<div class="line">        <span class="keywordflow">if</span> (buttonEngaged &amp;&amp; !teleoperationEngaged)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Store the current haptic device position as a reference starting point for teleoperation.</span></div>
<div class="line">            masterStartPosition = masterCurrent.position();</div>
<div class="line">            masterStartRotation = masterCurrent.rotation();</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Store the current robot position as a reference starting point for teleoperation.</span></div>
<div class="line">            slaveStartPosition = slaveCurrent.position();</div>
<div class="line">            slaveStartRotation = slaveCurrent.rotation();</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Engage teloperation.</span></div>
<div class="line">            teleoperationEngaged = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!buttonEngaged &amp;&amp; teleoperationEngaged)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Disengage teleoperation.</span></div>
<div class="line">            teleoperationEngaged = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If teleoperation is not engaged, we set no force and no torque on the device.</span></div>
<div class="line">        <span class="keywordflow">if</span> (!teleoperationEngaged)</div>
<div class="line">        {</div>
<div class="line">            force.setZero();</div>
<div class="line">            torque.setZero();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If teleoperation is engaged, reproduce the relative movement of the master (with respect</span></div>
<div class="line">        <span class="comment">// to its starting point of reference) on the slave (with respect to its starting point of</span></div>
<div class="line">        <span class="comment">// reference), applying motion scaling along the way.</span></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Compute the slave linear movement to match the master&#39;s, with scaling.</span></div>
<div class="line">            Eigen::Vector3d masterLinearMove = masterCurrent.position() - masterStartPosition;</div>
<div class="line">            Eigen::Vector3d slaveLinearMove = LinearScaling * masterLinearMove;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the slave angular movement to match the master&#39;s. We also prevent</span></div>
<div class="line">            <span class="comment">// the angle to &quot;flip&quot; around to the other hemisphere to avoid control discontinuities.</span></div>
<div class="line">            Eigen::AngleAxisd masterAngularMove = Transform::angleAxis(masterCurrent.rotation() * masterStartRotation.transpose());</div>
<div class="line">            Eigen::AngleAxisd masterAngularMoveNoFlip = Transform::noFlip(masterAngularMove, previousMasterAngularMove);</div>
<div class="line">            Eigen::Matrix3d slaveAngularMove { Eigen::AngleAxisd { AngularScaling * masterAngularMoveNoFlip.angle(), masterAngularMoveNoFlip.axis() } };</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the slave absolute position by adding its relative movement to its point of reference.</span></div>
<div class="line">            slaveTarget.setPosition(slaveStartPosition + slaveLinearMove);</div>
<div class="line">            slaveTarget.setRotation(slaveAngularMove * slaveStartRotation);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Send the desired target position to the slave robot.</span></div>
<div class="line">            slaveRobot.setTarget(slaveTarget);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the virtual linear spring force.</span></div>
<div class="line">            Eigen::Vector3d linearSpringLength = slaveTarget.position() - slaveCurrent.position();</div>
<div class="line">            Eigen::Vector3d linearSpringForce = -1.0 * LinearStiffness * linearSpringLength;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the virtual angular spring torque.</span></div>
<div class="line">            Eigen::Matrix3d angularSpringLength = slaveTarget.rotation() * slaveCurrent.rotation().transpose();</div>
<div class="line">            Eigen::Vector3d angularSpringTorque = -1.0 * AngularStiffness * Transform::angles(angularSpringLength);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the master&#39;s angular move limit torque (caused by the &quot;no flipping&quot; condition).</span></div>
<div class="line">            Eigen::Matrix3d masterSpringLength = Eigen::Matrix3d { masterAngularMove } * Eigen::Matrix3d { masterAngularMoveNoFlip }.transpose();</div>
<div class="line">            Eigen::Vector3d masterSpringTorque = -1.0 * AngularStiffness * Transform::angles(masterSpringLength);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute the damping force.</span></div>
<div class="line">            Eigen::Vector3d dampingForce = -1.0 * LinearDamping * masterLinearVelocity;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Compute damping torque.</span></div>
<div class="line">            Eigen::Vector3d dampingTorque = -1.0 * AngularDamping * masterAngularVelocity;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Combine all force and torque contributions.</span></div>
<div class="line">            force = linearSpringForce + dampingForce;</div>
<div class="line">            torque = angularSpringTorque + masterSpringTorque + dampingTorque;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Send force to the haptic device.</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="dhdc_8h.html#a0dd37d7a6b608daee45b86c9ea48f1ad">dhdSetForceAndTorqueAndGripperForce</a>(force(0), force(1), force(2), torque(0), torque(1), torque(2), 0.0, a_deviceId) &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to set haptic force (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Turn all forces off on exit.</span></div>
<div class="line">    <a name="a10"></a><a class="code" href="dhdc_8h.html#a178cf9ffa46dfe3d25dda74ecb34da31">dhdEnableForce</a>(<a class="code" href="dhdc_8h.html#aafe2b84f08a09e2acceb53b5ac6fd5f1">DHD_OFF</a>, a_deviceId);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Let everyone know that we are stopping.</span></div>
<div class="line">    simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;teleoperation thread stopped&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when the GLFW window is resized.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onWindowResized(GLFWwindow* a_window,</div>
<div class="line">                     <span class="keywordtype">int</span> a_width,</div>
<div class="line">                     <span class="keywordtype">int</span> a_height)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> glAspect = (<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(a_width) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(a_height));</div>
<div class="line"> </div>
<div class="line">    glViewport(0, 0, a_width, a_height);</div>
<div class="line">    glMatrixMode(GL_PROJECTION);</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">    gluPerspective(60, glAspect, 0.01, 10);</div>
<div class="line">    gluLookAt(0.2, 0.0, 0.0,</div>
<div class="line">              0.0, 0.0, 0.0,</div>
<div class="line">              0.0, 0.0, 1.0);</div>
<div class="line">    glMatrixMode(GL_MODELVIEW);</div>
<div class="line">    glLoadIdentity();</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when a key is pressed in the GLFW window.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onKeyPressed(GLFWwindow* a_window,</div>
<div class="line">                  <span class="keywordtype">int</span> a_key,</div>
<div class="line">                  <span class="keywordtype">int</span> a_scanCode,</div>
<div class="line">                  <span class="keywordtype">int</span> a_action,</div>
<div class="line">                  <span class="keywordtype">int</span> a_modifiers)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Ignore all keyboard events that are not key presses.</span></div>
<div class="line">    <span class="keywordflow">if</span> (a_action != GLFW_PRESS)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Map keys to events and process accordingly.</span></div>
<div class="line">    <span class="keywordflow">switch</span> (a_key)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> GLFW_KEY_ESCAPE:</div>
<div class="line">        <span class="keywordflow">case</span> GLFW_KEY_Q:</div>
<div class="line">        {</div>
<div class="line">            simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> GLFW_KEY_SPACE:</div>
<div class="line">        {</div>
<div class="line">            engageOverride = !engageOverride;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// This function is called when the GLFW library reports an error.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// \note See GLFW documentation for a description of the parameters.</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> onError(<span class="keywordtype">int</span> a_error,</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">char</span>* a_description)</div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; a_description &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">void</span> userInterfaceLoop()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialize GLFW library.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!glfwInit())</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to initialized GLFW&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// GLFW window handle</span></div>
<div class="line">    GLFWwindow *window = NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set error callback.</span></div>
<div class="line">    glfwSetErrorCallback(onError);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute desired size of window.</span></div>
<div class="line">    <span class="keyword">const</span> GLFWvidmode* mode = glfwGetVideoMode(glfwGetPrimaryMonitor());</div>
<div class="line">    <span class="keywordtype">int</span> width = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.8 * mode-&gt;height);</div>
<div class="line">    <span class="keywordtype">int</span> height = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * mode-&gt;height);</div>
<div class="line">    <span class="keywordtype">int</span> x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * (mode-&gt;width - width));</div>
<div class="line">    <span class="keywordtype">int</span> y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(0.5 * (mode-&gt;height - height));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure OpenGL rendering.</span></div>
<div class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 2);</div>
<div class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 1);</div>
<div class="line">    glfwWindowHint(GLFW_DOUBLEBUFFER, GLFW_TRUE);</div>
<div class="line">    glfwWindowHint(GLFW_SAMPLES, 4);</div>
<div class="line">    glfwWindowHint(GLFW_STEREO, GL_FALSE);</div>
<div class="line">    glfwWindowHint(GLFW_VISIBLE, GL_FALSE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Apply platform-specific settings.</span></div>
<div class="line"><span class="preprocessor">#ifdef MACOSX</span></div>
<div class="line"> </div>
<div class="line">    glfwWindowHint(GLFW_COCOA_RETINA_FRAMEBUFFER, GL_FALSE);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create window and display context.</span></div>
<div class="line">    window = glfwCreateWindow(width, height, <span class="stringliteral">&quot;Force Dimension - Virtual Teleoperation Example&quot;</span>, NULL, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (!window)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed create GLFW window&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure window.</span></div>
<div class="line">    glfwMakeContextCurrent(window);</div>
<div class="line">    glfwSetKeyCallback(window, onKeyPressed);</div>
<div class="line">    glfwSetWindowSizeCallback(window, onWindowResized);</div>
<div class="line">    glfwSetWindowPos(window, x, y);</div>
<div class="line">    glfwSwapInterval(1);</div>
<div class="line">    glfwShowWindow(window);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Adjust initial window size.</span></div>
<div class="line">    onWindowResized(window, width, height);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// set material properties</span></div>
<div class="line">    GLfloat mat_ambient[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    GLfloat mat_diffuse[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    GLfloat mat_specular[] = { 0.5f, 0.5f, 0.5f };</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT, mat_ambient);</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_DIFFUSE, mat_diffuse);</div>
<div class="line">    glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, mat_specular);</div>
<div class="line">    glMaterialf(GL_FRONT_AND_BACK, GL_SHININESS, 1.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// set light source</span></div>
<div class="line">    GLfloat ambient[] = { 0.5f, 0.5f, 0.5f, 1.0f };</div>
<div class="line">    GLfloat diffuse[] = { 0.8f, 0.8f, 0.8f, 1.0f };</div>
<div class="line">    GLfloat specular[] = { 1.0f, 1.0f, 1.0f, 1.0f };</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_SPECULAR, specular);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_CONSTANT_ATTENUATION, 1.0);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_LINEAR_ATTENUATION, 0.0);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_QUADRATIC_ATTENUATION, 0.0);</div>
<div class="line"> </div>
<div class="line">    GLfloat lightPos[] = { 2.0, 0.0, 0.0, 1.0f };</div>
<div class="line">    GLfloat lightDir[] = { -1.0, 0.0, 0.0, 1.0f };</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_POSITION, lightPos);</div>
<div class="line">    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, lightDir);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_SPOT_CUTOFF, 180);</div>
<div class="line">    glLightf(GL_LIGHT0, GL_SPOT_EXPONENT, 1.0);</div>
<div class="line">    glEnable(GL_LIGHTING);</div>
<div class="line">    glEnable(GL_LIGHT0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Main graphic loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (simulationRunning &amp;&amp; !glfwWindowShouldClose(window))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Throttle rendering at 40 Hz.</span></div>
<div class="line">        std::this_thread::sleep_for(std::chrono::milliseconds(25));</div>
<div class="line"> </div>
<div class="line">        updateGraphics();</div>
<div class="line">        glfwSwapBuffers(window);</div>
<div class="line">        glfwPollEvents();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close window.</span></div>
<div class="line">    glfwDestroyWindow(window);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Terminate GLFW library.</span></div>
<div class="line">    glfwTerminate();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Ask teleoperation to stop as well.</span></div>
<div class="line">    simulationRunning = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Display information.</span></div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Force Dimension - Virtual Teleoperation Example &quot;</span> &lt;&lt; <a name="a11"></a><a class="code" href="dhdc_8h.html#a922e46d7c95f29648069c8f47d4c4a99">dhdGetSDKVersionStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Copyright (C) 2001-2023 Force Dimension&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;All Rights Reserved.&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open haptic device.</span></div>
<div class="line">    <span class="keywordtype">int</span> deviceId = drdOpen();</div>
<div class="line">    <span class="keywordflow">if</span> (deviceId &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to open haptic device (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get haptic device serial number.</span></div>
<div class="line">    uint16_t serialNumber = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a12"></a><a class="code" href="dhdc_8h.html#a2bbef08448bf182eb62ad81d8a36adba">dhdGetSerialNumber</a>(&amp;serialNumber, deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;warning: failed to retrieve device serial number (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize haptic device if required.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;initializing haptic device...\r&quot;</span>;</div>
<div class="line">    std::cout.flush();</div>
<div class="line">    <span class="keywordflow">if</span> (!drdIsInitialized(deviceId) &amp;&amp; drdAutoInit(deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to initialize device (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Identify the device.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;connected to &quot;</span> &lt;&lt; <a name="a13"></a><a class="code" href="dhdc_8h.html#aa5ff16e7ee635f5a2ac186ead8d075c9">dhdGetSystemName</a>(deviceId) &lt;&lt; <span class="stringliteral">&quot; S/N &quot;</span> &lt;&lt; std::setw(5) &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; serialNumber &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start robotic regulation if required.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!drdIsRunning(deviceId) &amp;&amp; drdStart(deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to start robotic regulation (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Display instructions.</span></div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Hold the user button on the haptic device to engage teleoperation, or&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;press &#39; &#39; in the UI window to engage/disengage teleoperation, or&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;press &#39;q&#39; in the UI window to quit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Align the master haptic device with the slave robot initial position.</span></div>
<div class="line">    <span class="comment">// In this example, the slave robot initial position is located at the center of the workspace.</span></div>
<div class="line">    <span class="keywordtype">double</span> initialPosition[<a name="a14"></a><a class="code" href="dhdc_8h.html#a00142ac8c54982133a6b2c826a7b77dc">DHD_MAX_DOF</a>] = {};</div>
<div class="line">    <span class="keywordflow">if</span> (drdMoveTo(initialPosition, <span class="keyword">true</span>, deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to align master with slave (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start the teleoperation thread.</span></div>
<div class="line">    std::thread teleoperationThread(teleoperationControlLoop, deviceId);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the user interface.</span></div>
<div class="line">    userInterfaceLoop();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wait for both threads to terminate.</span></div>
<div class="line">    teleoperationThread.join();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close the connection to the haptic device.</span></div>
<div class="line">    <span class="keywordflow">if</span> (drdClose(deviceId) &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;error: failed to close the connection (&quot;</span> &lt;&lt; <a class="code" href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Report success.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;connection closed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="adhdc_8h_html_a2a29fb157bbcd49cd1807a5febf314e7"><div class="ttname"><a href="dhdc_8h.html#a2a29fb157bbcd49cd1807a5febf314e7">dhdGetLinearVelocity</a></div><div class="ttdeci">int __SDK dhdGetLinearVelocity(double *vx, double *vy, double *vz, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:2179</div></div>
<div class="ttc" id="adhdc_8h_html_a954c547357c73924b75bdf576f2abe12"><div class="ttname"><a href="dhdc_8h.html#a954c547357c73924b75bdf576f2abe12">dhdGetButton</a></div><div class="ttdeci">int __SDK dhdGetButton(int index, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:1187</div></div>
<div class="ttc" id="adhdc_8h_html_ac712aa9c49acad0e9e30c28b732fc5ca"><div class="ttname"><a href="dhdc_8h.html#ac712aa9c49acad0e9e30c28b732fc5ca">dhdGetAngularVelocityRad</a></div><div class="ttdeci">int __SDK dhdGetAngularVelocityRad(double *wx, double *wy, double *wz, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:2258</div></div>
<div class="ttc" id="adhdc_8h_html_ac60746c35e60ad4c5533dec253a341f1"><div class="ttname"><a href="dhdc_8h.html#ac60746c35e60ad4c5533dec253a341f1">DHD_ON</a></div><div class="ttdeci">#define DHD_ON</div><div class="ttdef"><b>Definition:</b> dhdc.h:126</div></div>
<div class="ttc" id="adhdc_8h_html_a4e6e5502f908607bfdf1e017d7fa76ec"><div class="ttname"><a href="dhdc_8h.html#a4e6e5502f908607bfdf1e017d7fa76ec">dhdGetPositionAndOrientationFrame</a></div><div class="ttdeci">int __SDK dhdGetPositionAndOrientationFrame(double *px, double *py, double *pz, double matrix[3][3], char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:1911</div></div>
<div class="ttc" id="adhdc_8h_html_aa493832a39c7e31b44752bda5d601209"><div class="ttname"><a href="dhdc_8h.html#aa493832a39c7e31b44752bda5d601209">dhdErrorGetLastStr</a></div><div class="ttdeci">const char *__SDK dhdErrorGetLastStr()</div><div class="ttdef"><b>Definition:</b> dhdError.cpp:197</div></div>
<div class="ttc" id="adhdc_8h_html_a0dd37d7a6b608daee45b86c9ea48f1ad"><div class="ttname"><a href="dhdc_8h.html#a0dd37d7a6b608daee45b86c9ea48f1ad">dhdSetForceAndTorqueAndGripperForce</a></div><div class="ttdeci">int __SDK dhdSetForceAndTorqueAndGripperForce(double fx, double fy, double fz, double tx, double ty, double tz, double fg, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:2028</div></div>
<div class="ttc" id="adhdc_8h_html_a2bbef08448bf182eb62ad81d8a36adba"><div class="ttname"><a href="dhdc_8h.html#a2bbef08448bf182eb62ad81d8a36adba">dhdGetSerialNumber</a></div><div class="ttdeci">int __SDK dhdGetSerialNumber(ushort *sn, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:540</div></div>
<div class="ttc" id="adhdc_8h_html_a178cf9ffa46dfe3d25dda74ecb34da31"><div class="ttname"><a href="dhdc_8h.html#a178cf9ffa46dfe3d25dda74ecb34da31">dhdEnableForce</a></div><div class="ttdeci">int __SDK dhdEnableForce(uchar val, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:4360</div></div>
<div class="ttc" id="adhdc_8h_html_aa5ff16e7ee635f5a2ac186ead8d075c9"><div class="ttname"><a href="dhdc_8h.html#aa5ff16e7ee635f5a2ac186ead8d075c9">dhdGetSystemName</a></div><div class="ttdeci">const char *__SDK dhdGetSystemName(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:806</div></div>
<div class="ttc" id="adhdc_8h_html_aa23bc77b009e020c05ef725eb533b60c"><div class="ttname"><a href="dhdc_8h.html#aa23bc77b009e020c05ef725eb533b60c">dhdEmulateButton</a></div><div class="ttdeci">int __SDK dhdEmulateButton(uchar val, char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:2929</div></div>
<div class="ttc" id="adhdc_8h_html_aafe2b84f08a09e2acceb53b5ac6fd5f1"><div class="ttname"><a href="dhdc_8h.html#aafe2b84f08a09e2acceb53b5ac6fd5f1">DHD_OFF</a></div><div class="ttdeci">#define DHD_OFF</div><div class="ttdef"><b>Definition:</b> dhdc.h:127</div></div>
<div class="ttc" id="adhdc_8h_html_a89cfe26f64150f8829daa35d9a302dc8"><div class="ttname"><a href="dhdc_8h.html#a89cfe26f64150f8829daa35d9a302dc8">dhdHasActiveGripper</a></div><div class="ttdeci">bool __SDK dhdHasActiveGripper(char ID=-1)</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:718</div></div>
<div class="ttc" id="adhdc_8h_html_a00142ac8c54982133a6b2c826a7b77dc"><div class="ttname"><a href="dhdc_8h.html#a00142ac8c54982133a6b2c826a7b77dc">DHD_MAX_DOF</a></div><div class="ttdeci">#define DHD_MAX_DOF</div><div class="ttdef"><b>Definition:</b> dhdc.h:131</div></div>
<div class="ttc" id="adhdc_8h_html_a922e46d7c95f29648069c8f47d4c4a99"><div class="ttname"><a href="dhdc_8h.html#a922e46d7c95f29648069c8f47d4c4a99">dhdGetSDKVersionStr</a></div><div class="ttdeci">const char *__SDK dhdGetSDKVersionStr()</div><div class="ttdef"><b>Definition:</b> dhdc.cpp:917</div></div>
<address class="separator"><hr>
</address>
<address class="footer">
<font size=-2>
<b>Haptic SDK 3.16.1 documentation</b><br>
Please address any questions to <a href="mailto:support@forcedimension.com">support@forcedimension.com</a><br>(C) 2001-2023 - <a href="http://www.forcedimension.com">Force Dimension</a><br>
All Rights Reserved.
</font>
</address>
</body>
</html>
